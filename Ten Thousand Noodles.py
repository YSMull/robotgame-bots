#2014-04-14 22:10:58.718496
import base64 
exec base64.b64decode('aW1wb3J0IHJnCmltcG9ydCByYW5kb20KCmNsYXNzIFJvYm90OgogICAgcm9ib3RTdG9yZSA9IHt9CiAgICBkZWYgYWN0KHNlbGYsIGdhbWUpOgogICAgICAgIHJldHVyblRoaXMgPSByb2JvdEFJKHNlbGYsIGdhbWUsIFJvYm90LnJvYm90U3RvcmUpCiAgICAgICAgaWYgcmV0dXJuVGhpc1swXSA9PSAnbW92ZSc6CgkJUm9ib3Qucm9ib3RTdG9yZVtzZWxmLnJvYm90X2lkXSA9IFN0b3JlKHNlbGYucm9ib3RfaWQsIHJldHVyblRoaXNbMV0sIHNlbGYuaHApCgllbHNlOgoJCVJvYm90LnJvYm90U3RvcmVbc2VsZi5yb2JvdF9pZF0gPSBOb25lCglyZXR1cm4gcmV0dXJuVGhpcwoKZGVmIHJvYm90QUkoc2VsZiwgZ2FtZSwgcm9ib3RTdG9yZSk6CiAgICBjb2xsaWRlZCA9IEZhbHNlCiAgICBtb3ZlU3VjY2VzcyA9IFRydWUKICAgIGlmIHNlbGYucm9ib3RfaWQgaW4gcm9ib3RTdG9yZSBhbmQgcm9ib3RTdG9yZVtzZWxmLnJvYm90X2lkXToKICAgICAgICBjb2xsaWRlZCA9IHJvYm90U3RvcmVbc2VsZi5yb2JvdF9pZF0uY29sbGlzaW9uKHNlbGYuaHApCiAgICAgICAgbW92ZVN1Y2Nlc3MgPSByb2JvdFN0b3JlW3NlbGYucm9ib3RfaWRdLm1vdmVTdWNlc3Moc2VsZi5sb2NhdGlvbikKICAgIHJvYm90TGlzdCA9IGdldEVuZW15Um9ib3Qoc2VsZiwgZ2FtZSkKICAgIGFjdGlvbiA9IGNob29zZUFjdGlvbihzZWxmLCBnYW1lLCByb2JvdExpc3QpCiAgICBpZiBhY3Rpb24gPT0gQWN0aW9uLlJ1bjoKICAgICAgICBydW5UZ3QgPSBydW4oc2VsZiwgZ2FtZSkKICAgICAgICBpZiBydW5UZ3QgPT0gc2VsZi5sb2NhdGlvbjoKICAgICAgICAgICAgcmV0dXJuWydzdWljaWRlJ10KICAgICAgICByZXR1cm4gWydtb3ZlJywgcnVuVGd0XQogICAgaWYgYWN0aW9uID09IEFjdGlvbi5DYXV0aW9uOgogICAgICAgIGRpcmVjdGlvbiA9IGdldERpcmVjdGlvblRvKHNlbGYubG9jYXRpb24sIHJvYm90TGlzdFswXS5sb2NhdGlvbikKICAgICAgICBpZiBkaXJlY3Rpb24gbm90IGluICgwLDkwLDE4MCwyNzApOgogICAgICAgICAgICBkaXJlY3Rpb24gKz0gKChpbnQocmFuZG9tLnJhbmRvbSgpIDwgLjUpKjIpLTEpKjQ1ICAjUmFuZG9tIDEgb3IgLTEKICAgICAgICByZXR1cm4gWydhdHRhY2snLCBnZXRTcXVhcmVpbkRpcihzZWxmLmxvY2F0aW9uLCBkaXJlY3Rpb24pXQogICAgaWYgYWN0aW9uID09IEFjdGlvbi5TdWljaWRlOgogICAgICAgIHJldHVybiBbJ3N1aWNpZGUnXQogICAgaWYgYWN0aW9uID09IEFjdGlvbi5NQ2VudGVyOgogICAgICAgIGlmIG1vdmVTdWNjZXNzID09IFRydWU6CiAgICAgICAgICAgIHJldHVyblsnbW92ZScsIHNlbGVjdE1vdmVMb2Moc2VsZixnYW1lLCByZy5DRU5URVJfUE9JTlQsIE5vbmUpXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICByZXR1cm5bJ21vdmUnLCBzZWxlY3RNb3ZlTG9jKHNlbGYsZ2FtZSwgcmcuQ0VOVEVSX1BPSU5ULCByb2JvdFN0b3JlW3NlbGYucm9ib3RfaWRdLnRhcmdldCldIAogICAgaWYgYWN0aW9uID09IEFjdGlvbi5BdHRhY2s6CiAgICAgICAgcmV0dXJuWydhdHRhY2snLCByZy50b3dhcmQoc2VsZi5sb2NhdGlvbiwgcm9ib3RMaXN0WzBdLmxvY2F0aW9uKV0KICAgIGlmIGFjdGlvbiA9PSBBY3Rpb24uTUVuZW15OgogICAgICAgIGZvciByb2JvdEluZGV4IGluIHhyYW5nZSgwLCBsZW4ocm9ib3RMaXN0KSk6CiAgICAgICAgICAgIGxvY0Fyb3VuZCA9IHJnLmxvY3NfYXJvdW5kKHJvYm90TGlzdFtyb2JvdEluZGV4XS5sb2NhdGlvbiwgZmlsdGVyX291dD0oJ2ludmFsaWQnLCAnb2JzdGFjbGUnLCAnc3Bhd24nKSkKICAgICAgICAgICAgZm9yIGkgaW4gbG9jQXJvdW5kWzpdOgogICAgICAgICAgICAgICAgaWYgaSBpbiBnYW1lLnJvYm90czoKICAgICAgICAgICAgICAgICAgICBsb2NBcm91bmQucmVtb3ZlKGkpCiAgICAgICAgICAgICAgICBsb2NBcm91bmQuc29ydChrZXk9bGFtYmRhIGxvYzogcmcud2Rpc3Qoc2VsZi5sb2NhdGlvbiwgbG9jKSkKICAgICAgICAgICAgaWYgbG9jQXJvdW5kOgogICAgICAgICAgICAgICAgaWYgbW92ZVN1Y2Nlc3MgPT0gVHJ1ZToKICAgICAgICAgICAgICAgICAgICAgcmV0dXJuWydtb3ZlJywgc2VsZWN0TW92ZUxvYyhzZWxmLGdhbWUsIGxvY0Fyb3VuZFswXSwgTm9uZSldCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICByZXR1cm5bJ21vdmUnLCBzZWxlY3RNb3ZlTG9jKHNlbGYsZ2FtZSwgbG9jQXJvdW5kWzBdLCByb2JvdFN0b3JlW3NlbGYucm9ib3RfaWRdLnRhcmdldCldIAogICAgI0NvZGUgc2hvdWxkIG5vdCByZWFjaCBoZXJlCiAgICBwcmludCAiT09QUyIKICAgIHJldHVybiBbJ2d1YXJkJ10KCmRlZiBjaG9vc2VBY3Rpb24oc2VsZiwgZ2FtZSwgcm9ib3RMaXN0KToKICAgIGlmIG5vdCByb2JvdExpc3Q6CiAgICAgICAgcmV0dXJuIEFjdGlvbi5NQ2VudGVyCiAgICBsb2NzQXJvdW5kID0gcmcubG9jc19hcm91bmQoc2VsZi5sb2NhdGlvbiwgZmlsdGVyX291dD0oJ2ludmFsaWQnLCAnb2JzdGFjbGUnKSkKICAgIGVuZW1pZXMgPSBlbmVtaWVzQXJvdW5kKHNlbGYsIGdhbWUsIHNlbGYubG9jYXRpb24pCiAgICBpZiBzZWxmLmhwIDwgbGVuKGVuZW1pZXMpKjEwOgogICAgICAgIHJldHVybiBBY3Rpb24uUnVuCiAgICBpZiByZy53ZGlzdChzZWxmLmxvY2F0aW9uLCByb2JvdExpc3RbMF0ubG9jYXRpb24pID09IDE6CiAgICAgICAgcmV0dXJuIEFjdGlvbi5BdHRhY2sKICAgIGlmICdzcGF3bicgaW4gcmcubG9jX3R5cGVzKHNlbGYubG9jYXRpb24pOgogICAgICAgIHJldHVybiBBY3Rpb24uTUNlbnRlcgogICAgaWYgcmcud2Rpc3Qoc2VsZi5sb2NhdGlvbiwgcm9ib3RMaXN0WzBdLmxvY2F0aW9uKSA9PSAyIGFuZCBzZWxmLmhwIDw9IDIwOgogICAgICAgIHJldHVybiBBY3Rpb24uQ2F1dGlvbgogICAgaWYgcmcud2Rpc3Qoc2VsZi5sb2NhdGlvbiwgcm9ib3RMaXN0WzBdLmxvY2F0aW9uKSA+PSAyOgogICAgICAgIHJldHVybiBBY3Rpb24uTUVuZW15CiAgICByZXR1cm4gQWN0aW9uLk1DZW50ZXIKZGVmIHNlbGVjdE1vdmVMb2Moc2VsZiwgZ2FtZSwgdGFyZ2V0LCBmYWlsZWRPbGQpOgogICAgbW92ZUxvY3MgPSByZy5sb2NzX2Fyb3VuZChzZWxmLmxvY2F0aW9uLCBmaWx0ZXJfb3V0PSgnaW52YWxpZCcsICdvYnN0YWNsZScsICdzcGF3bicpKQogICAgZm9yIGkgaW4gbW92ZUxvY3NbOl06CiAgICAgICAgaWYgaSBpbiBnYW1lLnJvYm90cyBvciAoZmFpbGVkT2xkIGFuZCBmYWlsZWRPbGQgPT0gaSk6CiAgICAgICAgICAgIG1vdmVMb2NzLnJlbW92ZShpKQogICAgbW92ZUxvY3Muc29ydChrZXk9bGFtYmRhIGxvYzogcmcud2Rpc3QobG9jLCB0YXJnZXQpKQogICAgaWYgbW92ZUxvY3M6CiAgICAgICAgcmV0dXJuIG1vdmVMb2NzWzBdCiAgICByZXR1cm4gcmcudG93YXJkKHNlbGYubG9jYXRpb24sIHRhcmdldCkKZGVmIHJ1bihzZWxmLCBnYW1lKToKICAgIGxvY0Fyb3VuZCA9IHJnLmxvY3NfYXJvdW5kKHNlbGYubG9jYXRpb24sIGZpbHRlcl9vdXQ9KCdpbnZhbGlkJywgJ29ic3RhY2xlJywgJ3NwYXduJykpCiAgICBmb3IgaSBpbiBsb2NBcm91bmQ6CiAgICAgICAgaWYgbGVuKHJvYm90c0Fyb3VuZChzZWxmLCBnYW1lLCBpKSkgPT0gMSBhbmQgaSBub3QgaW4gZ2FtZS5yb2JvdHM6CiAgICAgICAgICAgIHJldHVybiBpCiAgICByZXR1cm4gc2VsZi5sb2NhdGlvbgoKZGVmIGVuZW1pZXNBcm91bmQoc2VsZiwgZ2FtZSwgbG9jKToKICAgIGxvY3NBcm91bmQgPSByZy5sb2NzX2Fyb3VuZChsb2MpCiAgICBmb3IgaSBpbiBsb2NzQXJvdW5kWzpdOgogICAgICAgIGlmIGkgbm90IGluIGdhbWUucm9ib3RzIG9yIGdhbWUucm9ib3RzW2ldLnBsYXllcl9pZCA9PSBzZWxmLnBsYXllcl9pZDoKICAgICAgICAgICAgbG9jc0Fyb3VuZC5yZW1vdmUoaSkKICAgIHJldHVybiBsb2NzQXJvdW5kCmRlZiByb2JvdHNBcm91bmQoc2VsZiwgZ2FtZSwgbG9jKToKICAgIGxvY3NBcm91bmQgPSByZy5sb2NzX2Fyb3VuZChsb2MpCiAgICBmb3IgaSBpbiBsb2NzQXJvdW5kWzpdOgogICAgICAgIGlmIGkgbm90IGluIGdhbWUucm9ib3RzOgogICAgICAgICAgICBsb2NzQXJvdW5kLnJlbW92ZShpKQogICAgcmV0dXJuIGxvY3NBcm91bmQKCmRlZiBnZXRFbmVteVJvYm90KHNlbGYsIGdhbWUpOgogICAgcm9ib3RMaXN0ID0gW10KICAgIGZvciBsb2MsIHJvYm90IGluIGdhbWUucm9ib3RzLml0ZXJpdGVtcygpOgogICAgICAgIGlmIHJvYm90LnBsYXllcl9pZCAhPSBzZWxmLnBsYXllcl9pZDoKICAgICAgICAgICAgcm9ib3RMaXN0LmFwcGVuZChyb2JvdCkKICAgIHJvYm90TGlzdC5zb3J0KGtleT1sYW1iZGEgcm9ib3Q6IHJvYm90LmhwKQogICAgcm9ib3RMaXN0LnNvcnQoa2V5PWxhbWJkYSByb2JvdDogcmcud2Rpc3Qoc2VsZi5sb2NhdGlvbiwgcm9ib3QubG9jYXRpb24pKQogICAgcmV0dXJuIHJvYm90TGlzdApkZWYgZ2V0RGlyZWN0aW9uVG8oY3VyciwgdGFyZ2V0KToKICAgIGR4ID0gdGFyZ2V0WzBdIC0gY3VyclswXQogICAgZHkgPSB0YXJnZXRbMV0gLSBjdXJyWzFdCiAgICBpZiBkeSA8IDAgYW5kIGR4ID09IDA6CiAgICAgICAgcmV0dXJuIDAKICAgIGlmIGR5IDwgMCBhbmQgZHggPiAwOgogICAgICAgIHJldHVybiA0NQogICAgaWYgZHkgPT0gMCBhbmQgZHggPiAwOgogICAgICAgIHJldHVybiA5MAogICAgaWYgZHkgPiAwIGFuZCBkeCA+IDA6CiAgICAgICAgcmV0dXJuIDEzNQogICAgaWYgZHkgPiAwIGFuZCBkeCA9PSAwOgogICAgICAgIHJldHVybiAxODAKICAgIGlmIGR5ID4gMCBhbmQgZHggPCAwOgogICAgICAgIHJldHVybiAyMjUKICAgIGlmIGR5ID09IDAgYW5kIGR4IDwgMDoKICAgICAgICByZXR1cm4gMjcwCiAgICBpZiBkeSA8IDAgYW5kIGR4IDwgMDoKICAgICAgICByZXR1cm4gMzE1CiAgICByZXR1cm4gMApkZWYgZ2V0U3F1YXJlaW5EaXIoY3VyciwgZGlyZWN0aW9uKToKICAgIHdoaWxlIGRpcmVjdGlvbiA+PSAzNjA6CiAgICAgICAgZGlyZWN0aW9uIC09IDM2MAogICAgd2hpbGUgZGlyZWN0aW9uIDwgMDoKICAgICAgICBkaXJlY3Rpb24gKz0gMzYwCiAgICBpZiBkaXJlY3Rpb24gPT0gMDoKICAgICAgICByZXR1cm4gKGN1cnJbMF0sIGN1cnJbMV0tMSkKICAgIGlmIGRpcmVjdGlvbiA9PSA0NToKICAgICAgICByZXR1cm4gKGN1cnJbMF0rMSwgY3VyclsxXS0xKQogICAgaWYgZGlyZWN0aW9uID09IDkwOgogICAgICAgIHJldHVybiAoY3VyclswXSsxLCBjdXJyWzFdKQogICAgaWYgZGlyZWN0aW9uID09IDEzNToKICAgICAgICByZXR1cm4gKGN1cnJbMF0rMSwgY3VyclsxXSsxKQogICAgaWYgZGlyZWN0aW9uID09IDE4MDoKICAgICAgICByZXR1cm4gKGN1cnJbMF0sIGN1cnJbMV0rMSkKICAgIGlmIGRpcmVjdGlvbiA9PSAyMjU6CiAgICAgICAgcmV0dXJuIChjdXJyWzBdLTEsIGN1cnJbMV0rMSkKICAgIGlmIGRpcmVjdGlvbiA9PSAyNzA6CiAgICAgICAgcmV0dXJuIChjdXJyWzBdLTEsIGN1cnJbMV0pCiAgICBpZiBkaXJlY3Rpb24gPT0gMzE1OgogICAgICAgIHJldHVybiAoY3VyclswXS0xLCBjdXJyWzFdLTEpCiAgICBwcmludCAiUmV0dXJuZWQgTm90aGluZyAiICsgc3RyKGRpcmVjdGlvbikKY2xhc3MgQWN0aW9uOgogICAgTUNlbnRlciA9ICJNb3ZpbmcgdG8gQ2VudGVyIgogICAgQXR0YWNrID0gIkF0dGFja2luZyIKICAgIENhdXRpb24gPSAiQmVpbmcgQ2FyZWZ1bCIKICAgIE1FbmVteSA9ICJNb3ZpbmcgVG93YXJkIEVuZW15IgogICAgU3VpY2lkZSA9ICJTdWljaWRlIgogICAgUnVuID0gIlJ1bm5pbmcgQXdheSIKY2xhc3MgU3RvcmU6CiAgICByb2JvdElkID0gTm9uZQogICAgdGFyZ2V0ID0gTm9uZQogICAgaHAgPSBOb25lCiAgICBkZWYgX19pbml0X18oc2VsZiwgSUQsIHRndCwgaHApOgoJICAgIHNlbGYucm9ib3RJZCA9IElECgkgICAgc2VsZi50YXJnZXQgPSB0Z3QKCSAgICBzZWxmLmhwID0gaHAKICAgIGRlZiBtb3ZlU3VjZXNzKHNlbGYsIGN1cnJlbnRMb2MpOgogICAgICAgIGlmIGN1cnJlbnRMb2MgPT0gc2VsZi50YXJnZXQ6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBkZWYgY29sbGlzaW9uKHNlbGYsIGN1cnJIcCk6CiAgICAgICAgaWYgY3VyckhwID09IHNlbGYuaHAgLTU6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgcmV0dXJuIEZhbHNlCg==')
